<!DOCTYPE html>
<html>
  <head>
    <title>FoodMunch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="../libraries/jquery.mobile-1.4.5.min.css" />
    <script src="../libraries/jquery-1.11.3.min.js"></script>
    <script src="../libraries/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" href="../libraries/themes/foodMunchTheme.min.css" />
    <link rel="stylesheet" href="../libraries/themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="../styles/common.css" />
    <script src="../review/review.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <style>
    .button-back {
        position: relative!important;
        top: 10px!important;
        right: -6px;
    }
    .cart-description {
        position: relative!important;
        top: -24px!important;
        right: -44px;
        font-size: 20px;
    }
    .icon-review {
        position: relative!important;
        top: 10px!important;
        right: -4px;
        width: 45px;
        height: 45px;
    }
    .card-list {
        position: relative!important;
        top: 0px!important;
        right: 8px;
    }
   .reply {
        position: relative!important;
        top: -5px!important;
        right: 2px;
        font-size: 11px;
        color: gray!important;
    }
    .edit {
        position: relative!important;
        left: 40px;
        top: 54px!important;
        color:#FF7622!important;
    }
    body {
        font-family: Arial;
        width: 550px;
    }
    .comment-form-container {
        background: #bd4a4a;
        border: #e0dfdf 1px solid;
        padding: 20px;
        border-radius: 2px;
    }
    .input-row {
        margin-bottom: 20px;
    }
    .input-field {
        width: 100%;
        border-radius: 2px;
        padding: 10px;
        border: #e0dfdf 1px solid;
    }
    .btn-submit {
        padding: 10px 20px;
        background: #333;
        border: #1d1d1d 1px solid;
        color: #ffffff;
        font-size: 0.9em;
        width: 100px;
        border-radius: 2px;
        cursor:pointer;
    }
    ul {
        list-style-type: none;
    }
    .comment-row {
        border-bottom: #ebe3e1 1px solid;
        margin-bottom: 15px;
        padding: 15px;
    }
    .outer-comment {
        background: #fffafa;
        padding: 5px;
    }
    span.commet-row-label {
        font-style: italic;
    }
    span.posted-by {
        color: #FF7622;
    }
    .comment-info {
        font-size: 0.8em;
    }
    .comment-text {
        margin: 10px 0px;
    }
    .btn-reply {
        font-size: 0.8em;
        text-decoration: underline;
        color: #888787;
        cursor:pointer;
    }
    #comment-message {
        margin-left: 20px;
        color: #189a18;
        display: none;
    }
  </style>
  <body>
    <div class="p-1">
        <div class="ui-grid-a">
            <div class="ui-block-a">
                <label for="text-basic">
                <div class="ui-alt-icon">
                    <a href="#" target="_self" class="ui-btn ui-shadow ui-corner-all ui-icon-carat-l ui-btn-icon-notext ui-btn-inline button-back">Reviews</a>
                    <div class="cart-description">Reviews</div>
                </div>
                </label>
            </div>
            <div class="ui-block-b edit"><div class="ui-bar">ADD COMMENT
            </div></div>
        </div>
        <br>
        <form id="frm-comment">
            <div class="input-row">
                <input type="hidden" name="comment_id" id="commentId"
                placeholder="Name" /> <input class="input-field"
                type="text" name="name" id="name" placeholder="Name" />
            </div>
            <div class="input-row">
                <textarea class="input-field" type="text" name="comment"
                id="comment" placeholder="Add a Comment">  </textarea>
            </div>
            <div>
                <input type="button" class="btn-submit" id="submitButton" 
                value="Publish" />
                <div class="alert alert-success" id="comment-message" role="alert">
                    Comments Added Successfully!
                  </div>
            </div>
        </form>
        <div id="output"></div>
    </div>
    <div data-role="footer" data-position="fixed">
        <div data-role="header">
            <div data-role="navbar" >
            <ul>
                <li><a href="#" class="ui-btn-active border" target="_self" data-transition="slide"><img src="../assets/navBar/home.png" alt="Girl in a jacket" class="bar"></a></li>
                <li><a href="#" class="border" target="_self" data-transition="slide"><img src="../assets/navBar/account.png" alt="Girl in a jacket" class="bar"></a></li>
                <li><a href="cart.html" class="border" target="_self" data-transition="slide"><img src="../assets/navBar/cart.png" alt="Girl in a jacket" class="bar"></a></li>
                <li><a href="#" class="border" target="_self" data-transition="slide"><img src="../assets/navBar/qr.png" alt="Girl in a jacket" class="bar"></a></li>
            </ul>
            </div>
        </div> 
    </div>
  </body>
</html>



<script>
    function postReply(commentId) {
        $('#commentId').val(commentId);
        $("#name").focus();
    }
    $("#submitButton").click(function () {
           $("#comment-message").css('display', 'none');
        var str = $("#frm-comment").serialize();
        $.ajax({
            url: "comment-add.php",
            data: str,
            type: 'post',
            success: function (response)
            {
                setInterval('location.reload()', 1000);    
                var result = eval('(' + response + ')');
                if (response)
                {
                    $("#comment-message").css('display', 'inline-block');
                    $("#name").val("");
                    $("#comment").val("");
                    $("#commentId").val("");
                    listComment();
                } else
                {
                    alert("Failed to add comments !");
                    return false;
                }
            }
        });
    });
    $(document).ready(function () {
           listComment();
    });
    function listComment() {
        $.post("comment-list.php",
                function (data) {
                       var data = JSON.parse(data);
                    
                    var comments = "";
                    var replies = "";
                    var item = "";
                    var parent = -1;
                    var results = new Array();

                    var list = $("<ul class='outer-comment'>");
                    var item = $("<li>").html(comments);

                    for (var i = 0; (i < data.length); i++)
                    {
                        var commentId = data[i]['comment_id'];
                        parent = data[i]['parent_comment_id'];

                        if (parent == "0")
                        {
                            comments =  "<div class='row '>"+
                                        "<div class='col-2'>"+
                                        "<img src='../assets/icons/icon9.png' alt='Girl in a jacket' class='icon-review'>"+
                                        " </div>"+
                                        " <div class='col card-list'>"+
                                        "<div class='' >"+
                                        "<div class='card-one'>"+
                                        "<div class='comment-row'>"+
                                        "<div class='comment-info'><span class='commet-row-label'>from</span> <span class='posted-by'>" + data[i]['comment_sender_name'] + " </span> <span class='commet-row-label'>at</span> <span class='posted-at'>" + data[i]['date'] + "</span></div>" + 
                                        "<div class='comment-text'>" + data[i]['comment'] + "</div>"+
                                        "<div><a class='btn-reply reply' onClick='postReply(" + commentId + ")'>Reply</a></div>"+
                                        "</div>"+
                                        "</div>"+
                                        "</div>"+
                                        "</div>"+
                                        "</div>";

                            var item = $("<li>").html(comments);
                            list.append(item);
                            var reply_list = $('<ul>');
                            item.append(reply_list);
                            listReplies(commentId, data, reply_list);
                        }
                    }
                    $("#output").html(list);
                });
    }
                function listReplies(commentId, data, list) {
                    for (var i = 0; (i < data.length); i++)
                    {
                        if (commentId == data[i].parent_comment_id)
                        {
                            var comments =      "<div class='row '>"+
                                                "<div class='col-2'>"+
                                                "<img src='../assets/icons/icon10.png' alt='Girl in a jacket' class='icon-review'>"+
                                                " </div>"+
                                                " <div class='col card-list'>"+
                                                "<div class='' >"+
                                                "<div class='card-one'>"+
                                                "<div class='comment-row'>"+
                                                " <div class='comment-info'><span class='commet-row-label'>from</span> <span class='posted-by'>" + data[i]['comment_sender_name'] + " </span> <span class='commet-row-label'>at</span> <span class='posted-at'>" + data[i]['date'] + "</span></div>" + 
                                                "<div class='comment-text'>" + data[i]['comment'] + "</div>"+
                                                "<div><a class='btn-reply reply' onClick='postReply(" + data[i]['comment_id'] + ")'>Reply</a></div>"+
                                                "</div>"+
                                                "</div>"+
                                                "</div>"+
                                                "</div>"+
                                                "</div>";
                
                var item = $("<li>").html(comments);
                var reply_list = $('<ul>');
                list.append(item);
                item.append(reply_list);
                listReplies(data[i].comment_id, data, reply_list);
            }
        }
    }
</script>